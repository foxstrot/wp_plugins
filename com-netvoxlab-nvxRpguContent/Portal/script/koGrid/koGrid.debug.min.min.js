define(["jquery","knockout"],function(e,t){!function(o){"use strict";var n;o.kg||(o.kg={}),o.kg.numberOfGrids=0,o.kg.eventStorage={};var i="__kg_selected__",r=8,a=6,l="asc",s="desc",c="_kg_field_",d="_kg_depth_",g="_kg_hidden_",u="_kg_column_",p=/<.+>/;o.kg.moveSelectionHandler=function(e,t){var n,i,a,l;return o.kg.utils.isNullOrUndefined(e)||o.kg.utils.isNullOrUndefined(e.config.selectedItems)?!0:(n=t.which||t.keyCode,i=38===n?-1:40===n?1:null,i?(a=e.renderedRows(),l=a.indexOf(e.selectionService.lastClickedRow)+i,0>l||l>=a.length?!0:(e.selectionService.ChangeSelection(a[l],t),l>a.length-r?e.$viewport.scrollTop(e.$viewport.scrollTop()+e.config.rowHeight*r):r>l&&e.$viewport.scrollTop(e.$viewport.scrollTop()-e.config.rowHeight*r),!1)):!0)},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,o=Number(arguments[1])||0;for(o=0>o?Math.ceil(o):Math.floor(o),0>o&&(o+=t);t>o;o++)if(o in this&&this[o]===e)return o;return-1}),Array.prototype.filter||(Array.prototype.filter=function(e){var t,o,n,i,r=Object(this),a=r.length>>>0;if("function"!=typeof e)throw new TypeError;for(t=[],o=arguments[1],n=0;a>n;n++)n in r&&(i=r[n],e.call(o,i,n,r)&&t.push(i));return t}),o.kg.utils={visualLength:function(t){var o=document.getElementById("testDataLength");return o||(o=document.createElement("SPAN"),o.id="testDataLength",o.style.visibility="hidden",document.body.appendChild(o)),e(o).css("font",e(t).css("font")),o.innerHTML=e(t).text(),o.offsetWidth},forIn:function(e,t){for(var o in e)e.hasOwnProperty(o)&&t(e[o],o)},evalProperty:function(e,o){var n=t.utils.unwrapObservable(e),i=o.split("."),r=0,a=t.utils.unwrapObservable(n[i[r]]),l=i.length;for(r++;a&&l>r;)a=t.utils.unwrapObservable(a[i[r]]),r++;return a},endsWith:function(e,t){return e&&t&&"string"==typeof e?-1!==e.indexOf(t,e.length-t.length):!1},isNullOrUndefined:function(e){return void 0===e||null===e},getElementsByClassName:function(e){for(var t,o=[],n=new RegExp("\\b"+e+"\\b"),i=document.getElementsByTagName("*"),r=0;r<i.length;r++)t=i[r].className,n.test(t)&&o.push(i[r]);return o},getTemplatePromise:function(t){return e.ajax(t)},newId:function(){var e=(new Date).getTime();return function(){return e+=1}}(),ieVersion:function(){for(var e=3,t=document.createElement("div"),o=t.getElementsByTagName("i");t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->",o[0];);return e>4?e:void 0}()},e.extend(o.kg.utils,{isIe6:function(){return 6===o.kg.utils.ieVersion}(),isIe7:function(){return 7===o.kg.utils.ieVersion}(),isIe:function(){return void 0!==o.kg.utils.ieVersion}()}),o.kg.defaultGridTemplate=function(){return'<div data-bind="css: {\'ui-widget\': jqueryUITheme, \'kgNoSelect\' : disableTextSelection}"><div class="kgTopPanel" data-bind="css: {\'ui-widget-header\':jqueryUITheme, \'ui-corner-top\': jqueryUITheme}, style: $data.topPanelStyle"><div class="kgGroupPanel" data-bind="visible: $data.showGroupPanel, style: headerStyle"><div class="kgGroupPanelDescription" data-bind="visible: configGroups().length == 0">Drag a column header here and drop it to group by that column</div><ul data-bind="visible: configGroups().length > 0, foreach: configGroups" class="kgGroupList"><li class="kgGroupItem"><span class="kgGroupElement"><div class="kgGroupName"><span data-bind="text: displayName"></span><span data-bind="click: function(data) { $root.removeGroup($index()) }" class="kgRemoveGroup">x</span></div><span data-bind="visible: $index() < ($root.configGroups().length - 1)" class="kgGroupArrow"></span></span></li></ul></div><div class="kgHeaderContainer" data-bind="style: headerStyle"><div class="kgHeaderScroller" data-bind="style: headerScrollerStyle, kgHeaderRow: $data" ></div></div><div class="kgHeaderButton" data-bind="visible: ($data.showColumnMenu || $data.showFilter), click: toggleShowMenu"><div class="kgHeaderButtonArrow"></div></div><div data-bind="visible: showMenu" class="kgColMenu"><div data-bind="visible: showFilter"><input placeholder="Seach Field:Value" type="text" data-bind="value: filterText, valueUpdate: \'afterkeydown\'"/></div><div data-bind="visible: showColumnMenu"><span class="kgMenuText">Choose Columns:</span><ul class="kgColList" data-bind="foreach: nonAggColumns"><li class="kgColListItem"><label style="position: relative;"><input type="checkbox" class="kgColListCheckbox" data-bind="checked: visible"/><span data-bind="text: displayName, click: toggleVisible"></span><a title="Group By" data-bind="attr: {\'class\': groupedByClass }, visible: (field != \'✔\'), click: $parent.groupBy"></a><span class="kgGroupingNumber" data-bind="visible: groupIndex() > 0, text: groupIndex"></span></label></li></ul></div></div></div><div class="kgViewport" data-bind="css: {\'ui-widget-content\': jqueryUITheme}, style: viewportStyle"><div class="kgCanvas" data-bind="style: canvasStyle"><div data-bind="foreach: renderedRows" style="position: absolute;"><div data-bind="style: { \'top\': offsetTop, \'height\': $parent.rowHeight + \'px\' }, click: toggleSelected, css: {\'selected\': selected, \'even\': isEven , \'odd\': isOdd, \'ui-state-default\': $parent.jqueryUITheme && isOdd, \'ui-state-active\':$parent.jqueryUITheme && isEven}, kgRow: $data" class="kgRow"></div></div></div></div><div class="kgFooterPanel" data-bind="css: {\'ui-widget-content\': jqueryUITheme, \'ui-corner-bottom\': jqueryUITheme}, style: footerStyle"><div class="kgTotalSelectContainer" data-bind="visible: footerVisible"><div class="kgFooterTotalItems" data-bind="css: {\'kgNoMultiSelect\': !multiSelect}" ><span class="kgLabel">Total Items: <span data-bind="text: maxRowsDisplay"></span></span><span data-bind="visible: filterText().length > 0" class="kgLabel">(Showing: <span data-bind="text: totalFilteredItemsLength"></span>)</span></div><div class="kgFooterSelectedItems" data-bind="visible: multiSelect"><span class="kgLabel">Selected Items: <span data-bind="text: selectedItemCount"></span></span></div></div><div class="kgPagerContainer" style="float: right; margin-top: 10px;" data-bind="visible: (footerVisible && enablePaging), css: {\'kgNoMultiSelect\': !multiSelect}"><div style="float:left; margin-right: 10px;" class="kgRowCountPicker"><span style="float: left; margin-top: 3px;" class="kgLabel">Page Size:</span><select style="float: left;height: 27px; width: 45px" data-bind="value: pagingOptions.pageSize, options: pagingOptions.pageSizes"></select></div><div style="float:left; margin-right: 10px; line-height:25px;" class="kgPagerControl" style="float: left; min-width: 135px;"><button class="kgPagerButton" data-bind="click: pageToFirst, disable: cantPageBackward()" title="First Page"><div class="kgPagerFirstTriangle"><div class="kgPagerFirstBar"></div></div></button><button class="kgPagerButton" data-bind="click: pageBackward, disable: cantPageBackward()" title="Previous Page"><div class="kgPagerFirstTriangle kgPagerPrevTriangle"></div></button><input class="kgPagerCurrent" type="number" style="width:50px; height: 24px; margin-top: 1px; padding: 0px 4px;" data-bind="value: pagingOptions.currentPage, valueUpdate: \'afterkeydown\'"/><button class="kgPagerButton" data-bind="click: pageForward, disable: cantPageForward()" title="Next Page"><div class="kgPagerLastTriangle kgPagerNextTriangle"></div></button><button class="kgPagerButton" data-bind="click: pageToLast, disable: cantPageForward()" title="Last Page"><div class="kgPagerLastTriangle"><div class="kgPagerLastBar"></div></div></button></div></div></div></div>'},o.kg.defaultRowTemplate=function(){return"<div data-bind=\"style: { cursor : canSelectRows ? 'pointer' : 'default' }, foreach: $grid.visibleColumns, css: { 'ui-widget-content': $grid.jqueryUITheme }\"><div data-bind=\"attr: { 'class': cellClass() + ' kgCell col' + $index() }, kgCell: $data\"></div></div>"},o.kg.defaultCellTemplate=function(){return"<div data-bind=\"attr: { 'class': 'kgCellText colt' + $index()}, html: $data.getProperty($parent)\"></div>"},o.kg.aggregateTemplate=function(){return'<div data-bind="click: toggleExpand, style: {\'left\': offsetLeft()}" class="kgAggregate"><span class="kgAggregateText" data-bind="html: $data.label">(<span data-bind="html: totalChildren"></span> Items)</span><div data-bind="attr: {\'class\' : aggClass }"></div></div>'},o.kg.defaultHeaderRowTemplate=function(){return"<div data-bind=\"foreach: visibleColumns\"><div data-bind=\"kgHeaderCell: $data, attr: { 'class': 'kgHeaderCell col' + $index() }\"></div></div>"},o.kg.defaultHeaderCellTemplate=function(){return"<div data-bind=\"style: { cursor : sortable() ? 'pointer' : 'default' }, click: sort, css: {'kgSorted': !noSortVisible }, attr: {'class': 'kgHeaderSortColumn ' + headerClass()}\"><div data-bind=\"attr: { 'class': 'colt' + $index() + ' kgHeaderText' }, html: displayName\"></div><div class=\"kgSortButtonDown\" data-bind=\"visible: showSortButtonDown\"></div><div class=\"kgSortButtonUp\" data-bind=\"visible: showSortButtonUp\"></div><div data-bind=\"visible: resizable, click: gripClick, mouseEvents: { mouseDown: gripOnMouseDown }\" class=\"kgHeaderGrip\" ></div></div>"},t.bindingHandlers.koGrid=function(){return{init:function(n,i,r,a,l){var s,c,d=i(),g=e(n);return d.gridDim=new o.kg.Dimension({outerHeight:t.observable(g.height()),outerWidth:t.observable(g.width())}),s=new o.kg.Grid(d),c=e(o.kg.defaultGridTemplate()),d.data.subscribe(function(){s.$$selectionPhase||(s.searchProvider.evalFilter(),s.refreshDomSizes())}),t.isObservable(d.columnDefs)&&d.columnDefs.subscribe(function(e){s.columns([]),s.config.columnDefs=e,s.buildColumns(),s.configureColumnWidths()}),g.addClass("koGrid").addClass(s.gridId.toString()),g.append(c),s.$userViewModel=l.$data,t.applyBindings(s,c[0]),o.kg.domUtilityService.AssignGridContainers(g,s),s.configureColumnWidths(),s.refreshDomSizes(),s.eventProvider=new o.kg.EventProvider(s),e.each(s.config.plugins,function(e,t){"function"==typeof t.onGridInit&&t.onGridInit(s)}),o.kg.domUtilityService.BuildStyles(s),{controlsDescendantBindings:!0}}}}(),t.bindingHandlers.kgRow=function(){return{init:function(n,i,r,a,l){var s,c,d=i(),g=d.$grid=l.$parent;return s=d.isAggRow?o.kg.aggregateTemplate():g.rowTemplate,c=function(o){var i=e(o);d.$userViewModel=l.$parent.$userViewModel,t.applyBindings(d,i[0]),e(n).html(i)},s.then?s.then(function(e){c(e)}):c(s),{controlsDescendantBindings:!0}}}}(),t.bindingHandlers.kgCell=function(){return{init:function(o,n,i,r,a){a.$userViewModel=a.$parent.$userViewModel;var l=function(n){var i=e(n);t.applyBindings(a,i[0]),e(o).html(i)};return r.cellTemplate.then?r.cellTemplate.then(function(e){l(e)}):l(r.cellTemplate),{controlsDescendantBindings:!0}}}}(),t.bindingHandlers.kgHeaderRow=function(){return{init:function(o,n,i,r,a){a.$userViewModel=a.$data.$userViewModel;var l=function(n){var i=e(n);t.applyBindings(a,i[0]),e(o).html(i)};return r.headerRowTemplate.then?r.headerRowTemplate.then(function(e){l(e)}):l(r.headerRowTemplate),{controlsDescendantBindings:!0}}}}(),t.bindingHandlers.kgHeaderCell=function(){return{init:function(o,n,i,r,a){var l=a.extend({$grid:a.$parent,$userViewModel:a.$parent.$userViewModel}),s=function(n){var i=e(n);t.applyBindings(l,i[0]),e(o).html(i)};return r.headerCellTemplate.then?r.headerCellTemplate.then(function(e){s(e)}):s(r.headerCellTemplate),{controlsDescendantBindings:!0}}}}(),t.bindingHandlers.mouseEvents=function(){return{init:function(t,o){var n=o();n.mouseDown&&e(t).mousedown(n.mouseDown)}}}(),o.kg.Aggregate=function(o,n){var i=this;i.index=0,i.offsetTop=t.observable(0),i.entity=o,i.label=t.observable(o.gLabel),i.field=o.gField,i.depth=o.gDepth,i.parent=o.parent,i.children=o.children,i.aggChildren=o.aggChildren,i.aggIndex=o.aggIndex,i.collapsed=t.observable(!0),i.isAggRow=!0,i.offsetLeft=t.observable((25*o.gDepth).toString()+"px"),i.aggLabelFilter=o.aggLabelFilter,i.toggleExpand=function(){var e=i.collapsed();i.collapsed(!e),i.notifyChildren()},i.setExpand=function(e){i.collapsed(e),i.notifyChildren()},i.notifyChildren=function(){e.each(i.aggChildren,function(e,t){if(t.entity[g]=i.collapsed(),i.collapsed()){var o=i.collapsed();t.setExpand(o)}}),e.each(i.children,function(e,t){t[g]=i.collapsed()}),n.rowCache=[];var t=!1;e.each(n.aggCache,function(e,o){if(t){var n=30*i.children.length,r=i.collapsed();o.offsetTop(r?o.offsetTop()-n:o.offsetTop()+n)}else e==i.aggIndex&&(t=!0)}),n.renderedChange()},i.aggClass=t.computed(function(){return i.collapsed()?"kgAggArrowCollapsed":"kgAggArrowExpanded"}),i.totalChildren=t.computed(function(){if(i.aggChildren.length>0){var t=0,o=function(n){n.aggChildren.length>0?e.each(n.aggChildren,function(e,t){o(t)}):t+=n.children.length};return o(i),t}return i.children.length}),i.selected=t.observable(!1),i.isEven=t.observable(!1),i.isOdd=t.observable(!1),i.toggleSelected=function(){return!0}},o.kg.Column=function(n,i){var r=this,a=n.colDef,c=500,d=0,g=null;r.eventTaget=void 0,r.width=a.width,r.groupIndex=t.observable(0),r.isGroupedBy=t.observable(!1),r.groupedByClass=t.computed(function(){return r.isGroupedBy()?"kgGroupedByIcon":"kgGroupIcon"}),r.sortable=t.observable(!1),r.resizable=t.observable(!1),r.minWidth=a.minWidth?a.minWidth:50,r.maxWidth=a.maxWidth?a.maxWidth:9e3,r.headerRowHeight=n.headerRowHeight,r.displayName=t.observable(a.displayName||a.field),r.index=n.index,r.isAggCol=n.isAggCol,r.cellClass=t.observable(a.cellClass||""),r.cellFilter=a.cellFilter||a.cellFormatter,r.field=a.field,r.aggLabelFilter=a.cellFilter||a.cellFormatter||a.aggLabelFilter||a.aggLabelFormatter,r._visible=t.observable(o.kg.utils.isNullOrUndefined(a.visible)||a.visible),r.visible=t.computed({read:function(){return r._visible()},write:function(e){r.toggleVisible(e)}}),n.enableSort&&r.sortable(o.kg.utils.isNullOrUndefined(a.sortable)||a.sortable),n.enableResize&&r.resizable(o.kg.utils.isNullOrUndefined(a.resizable)||a.resizable),r.sortDirection=t.observable(void 0),r.sortingAlgorithm=a.sortFn,r.headerClass=t.observable(a.headerClass),r.headerCellTemplate=a.headerCellTemplate||o.kg.defaultHeaderCellTemplate(),r.cellTemplate=a.cellTemplate||o.kg.defaultCellTemplate(),a.cellTemplate&&!p.test(a.cellTemplate)&&(r.cellTemplate=o.kg.utils.getTemplatePromise(a.cellTemplate)),a.headerCellTemplate&&!p.test(a.headerCellTemplate)&&(r.headerCellTemplate=o.kg.utils.getTemplatePromise(a.headerCellTemplate)),r.getProperty=function(e){return r.cellFilter?r.cellFilter(e.getProperty(r.field)):e.getProperty(r.field)},r.toggleVisible=function(e){var t;t=o.kg.utils.isNullOrUndefined(e)||"object"==typeof e?!r._visible():e,r._visible(t),o.kg.domUtilityService.BuildStyles(i)},r.showSortButtonUp=t.computed(function(){return r.sortable?r.sortDirection()===s:r.sortable}),r.showSortButtonDown=t.computed(function(){return r.sortable?r.sortDirection()===l:r.sortable}),r.noSortVisible=t.computed(function(){return!r.sortDirection()}),r.sort=function(){if(!r.sortable())return!0;var e=r.sortDirection()===l?s:l;return r.sortDirection(e),n.sortCallback(r,e),!1},r.gripClick=function(e,t){t.stopPropagation(),d++,1===d?g=setTimeout(function(){d=0},c):(clearTimeout(g),n.resizeOnDataCallback(r),d=0)},r.gripOnMouseDown=function(t){return t.stopPropagation(),t.ctrlKey?(r.toggleVisible(),o.kg.domUtilityService.BuildStyles(i),i.config.columnsChanged(i.columns.peek()),!0):(r.eventTaget=t.target.parentElement,r.eventTaget.style.cursor="col-resize",r.startMousePosition=t.clientX,r.origWidth=r.width,e(document).mousemove(r.onMouseMove),e(document).mouseup(r.gripOnMouseUp),!1)},r.onMouseMove=function(e){e.stopPropagation();var t=e.clientX-r.startMousePosition,n=t+r.origWidth;return r.width=n<r.minWidth?r.minWidth:n>r.maxWidth?r.maxWidth:n,o.kg.domUtilityService.BuildStyles(i),!1},r.gripOnMouseUp=function(t){return t.stopPropagation(),e(document).off("mousemove"),e(document).off("mouseup"),r.eventTaget.style.cursor=r.sortable()?"pointer":"default",r.eventTaget=void 0,i.config.columnsChanged(i.columns.peek()),!1}},o.kg.Dimension=function(t){this.outerHeight=null,this.outerWidth=null,e.extend(this,t)},o.kg.EventProvider=function(n){var i=this;i.colToMove=void 0,i.groupToMove=void 0,i.assignEvents=function(){n.config.jqueryUIDraggable?(n.$groupPanel.droppable({addClasses:!1,drop:function(e){i.onGroupDrop(e)}}),e(document).ready(i.setDraggables)):(n.$groupPanel.on("mousedown",i.onGroupMouseDown).on("dragover",i.dragOver).on("drop",i.onGroupDrop),n.$headerScroller.on("mousedown",i.onHeaderMouseDown).on("dragover",i.dragOver).on("drop",i.onHeaderDrop),n.config.enableRowReordering&&n.$viewport.on("mousedown",i.onRowMouseDown).on("dragover",i.dragOver).on("drop",i.onRowDrop),i.setDraggables()),n.columns.subscribe(i.setDraggables)},i.dragOver=function(e){e.preventDefault()},i.setDraggables=function(){n.config.jqueryUIDraggable?n.$root.find(".kgHeaderSortColumn").draggable({helper:"clone",appendTo:"body",stack:"div",addClasses:!1,start:function(e){i.onHeaderMouseDown(e)}}).droppable({drop:function(e){i.onHeaderDrop(e)}}):(n.$root.find(".kgHeaderSortColumn").attr("draggable","true"),-1!=navigator.userAgent.indexOf("MSIE")&&n.$root.find(".kgHeaderSortColumn").bind("selectstart",function(){return this.dragDrop(),!1}))},i.onGroupMouseDown=function(o){var r,a=e(o.target);"kgRemoveGroup"!=a[0].className?(r=t.dataFor(a[0]),r&&(n.config.jqueryUIDraggable||a.attr("draggable","true"),i.groupToMove={header:a,groupName:r,index:r.groupIndex()-1})):i.groupToMove=void 0},i.onGroupDrop=function(o){var r,a;i.groupToMove?(r=e(o.target).closest(".kgGroupElement"),"kgGroupPanel"==r.context.className?(n.configGroups.splice(i.groupToMove.index,1),n.configGroups.push(i.groupToMove.groupName)):(a=t.dataFor(r[0]),a&&i.groupToMove.index!=a.groupIndex()&&(n.configGroups.splice(i.groupToMove.index,1),n.configGroups.splice(a.groupIndex(),0,i.groupToMove.groupName))),i.groupToMove=void 0,n.fixGroupIndexes()):(-1==n.configGroups.indexOf(i.colToMove.col)&&(r=e(o.target).closest(".kgGroupElement"),"kgGroupPanel"==r.context.className||"kgGroupPanelDescription"==r.context.className?n.groupBy(i.colToMove.col):(a=t.dataFor(r[0]),a&&n.removeGroup(a.groupIndex()))),i.colToMove=void 0)},i.onHeaderMouseDown=function(o){var n,r=e(o.target).closest(".kgHeaderSortColumn");return r[0]?(n=t.dataFor(r[0]),n&&(i.colToMove={header:r,col:n}),!0):!0},i.onHeaderDrop=function(r){var a,l,s;if(!i.colToMove||(a=e(r.target).closest(".kgHeaderSortColumn"),!a[0]))return!0;if(l=t.dataFor(a[0])){if(i.colToMove.col==l)return!0;s=n.columns.peek(),s.splice(i.colToMove.col.index,1),s.splice(l.index,0,i.colToMove.col),n.fixColumnIndexes(),n.columns(s),o.kg.domUtilityService.BuildStyles(n),i.colToMove=void 0}return!0},i.onRowMouseDown=function(n){var i,r=e(n.target).closest(".kgRow");r[0]&&(i=t.dataFor(r[0]),i&&(r.attr("draggable","true"),o.kg.eventStorage.rowToMove={targetRow:r,scope:i}))},i.onRowDrop=function(i){var r,a=e(i.target).closest(".kgRow"),l=t.dataFor(a[0]);if(l){if(r=o.kg.eventStorage.rowToMove,r.scope==l)return;var s=n.sortedData(),c=s.indexOf(r.scope.entity),d=s.indexOf(l.entity);n.sortedData.splice(c,1),n.sortedData.splice(d,0,r.scope.entity),n.searchProvider.evalFilter(),o.kg.eventStorage.rowToMove=void 0}},i.assignGridEventHandlers=function(){n.$viewport.scroll(function(e){var t=e.target.scrollLeft,o=e.target.scrollTop;n.adjustScrollLeft(t),n.adjustScrollTop(o)}),n.$viewport.off("keydown"),n.$viewport.on("keydown",function(e){return o.kg.moveSelectionHandler(n,e)}),-1===n.config.tabIndex?(n.$viewport.attr("tabIndex",o.kg.numberOfGrids),o.kg.numberOfGrids++):n.$viewport.attr("tabIndex",n.config.tabIndex),e(o).resize(function(){o.kg.domUtilityService.UpdateGridLayout(n),n.config.maintainColumnRatios&&n.configureColumnWidths()})},i.assignGridEventHandlers(),i.assignEvents()},o.kg.RowFactory=function(t){var n=this;n.rowCache=[],n.aggCache={},n.parentCache=[],n.dataChanged=!0,n.parsedData=[],n.rowConfig={},n.selectionService=t.selectionService,n.rowHeight=30,n.numberOfAggregates=0,n.groupedData=void 0,n.rowHeight=t.config.rowHeight,n.rowConfig={canSelectRows:t.config.canSelectRows,rowClasses:t.config.rowClasses,selectedItems:t.config.selectedItems,selectWithCheckboxOnly:t.config.selectWithCheckboxOnly,beforeSelectionChangeCallback:t.config.beforeSelectionChange,afterSelectionChangeCallback:t.config.afterSelectionChange},n.renderedRange=new o.kg.Range(0,t.minRowsToRender()+r),n.buildEntityRow=function(e,t){var r=n.rowCache[t];return r||(r=new o.kg.Row(e,n.rowConfig,n.selectionService),r.rowIndex(t+1),r.offsetTop((n.rowHeight*t).toString()+"px"),r.selected(e[i]),n.rowCache[t]=r),r},n.buildAggregateRow=function(e,t){var i=n.aggCache[e.aggIndex];return i||(i=new o.kg.Aggregate(e,n),n.aggCache[e.aggIndex]=i),i.index=t+1,i.offsetTop((n.rowHeight*t).toString()+"px"),i},n.UpdateViewableRange=function(e){n.renderedRange=e,n.renderedChange()},n.filteredDataChanged=function(){t.lateBoundColumns&&t.filteredData().length>1&&(t.config.columnDefs=void 0,t.buildColumns(),t.lateBoundColumns=!1),n.dataChanged=!0,n.rowCache=[],t.config.groups.length>0&&n.getGrouping(t.config.groups),n.UpdateViewableRange(n.renderedRange)},n.renderedChange=function(){if(!n.groupedData||t.config.groups.length<1)return n.renderedChangeNoGroups(),void t.refreshDomSizes();n.parentCache=[];var o=[],i=n.parsedData.filter(function(e){return e[g]===!1}).slice(n.renderedRange.topRow,n.renderedRange.bottomRow);e.each(i,function(e,t){var i;i=t.isAggRow?n.buildAggregateRow(t,n.renderedRange.topRow+e):n.buildEntityRow(t,n.renderedRange.topRow+e),o.push(i)}),t.setRenderedRows(o),t.refreshDomSizes()},n.renderedChangeNoGroups=function(){var o=[],i=t.filteredData.slice(n.renderedRange.topRow,n.renderedRange.bottomRow);e.each(i,function(e,t){var i=n.buildEntityRow(t,n.renderedRange.topRow+e);o.push(i)}),t.setRenderedRows(o)},n.parseGroupData=function(t){var o,i;if(t.values)e.each(t.values,function(e,t){n.parentCache[n.parentCache.length-1].children.push(t),n.parsedData.push(t)});else for(o in t){if(o==c||o==d||o==u)continue;t.hasOwnProperty(o)&&(i=n.buildAggregateRow({gField:t[c],gLabel:o,gDepth:t[d],isAggRow:!0,_kg_hidden_:!1,children:[],aggChildren:[],aggIndex:n.numberOfAggregates,aggLabelFilter:t[u].aggLabelFilter},0),n.numberOfAggregates++,i.parent=n.parentCache[i.depth-1],i.parent&&(i.parent.collapsed(!1),i.parent.aggChildren.push(i)),n.parsedData.push(i.entity),n.parentCache[i.depth]=i,n.parseGroupData(t[o]))}},n.getGrouping=function(i){n.aggCache=[],n.rowCache=[],n.numberOfAggregates=0,n.groupedData={};var r=t.filteredData(),a=i.length,l=t.columns();e.each(r,function(r,s){s[g]=!0;var p=n.groupedData;e.each(i,function(e,n){!l[e].isAggCol&&a>=e&&(t.columns.splice(s.gDepth,0,new o.kg.Column({colDef:{field:"",width:25,sortable:!1,resizable:!1,headerCellTemplate:'<div class="kgAggHeader"></div>'},isAggCol:!0,index:s.gDepth,headerRowHeight:t.config.headerRowHeight})),o.kg.domUtilityService.BuildStyles(t));var i=l.filter(function(e){return e.field==n})[0],r=o.kg.utils.evalProperty(s,n);i.cellFilter&&(r=i.cellFilter(r)),r=r?r.toString():"null",p[r]||(p[r]={}),p[c]||(p[c]=n),p[d]||(p[d]=e),p[u]||(p[u]=i),p=p[r]}),p.values||(p.values=[]),p.values.push(s)}),t.fixColumnIndexes(),n.parsedData.length=0,n.parseGroupData(n.groupedData)},t.config.groups.length>0&&t.filteredData().length>0&&n.getGrouping(t.config.groups)},o.kg.Grid=function(n){var l={rowHeight:30,columnWidth:100,headerRowHeight:30,footerRowHeight:55,footerVisible:!0,displayFooter:void 0,canSelectRows:!0,selectAllState:t.observable(!1),data:t.observableArray([]),columnDefs:void 0,selectedItems:t.observableArray([]),displaySelectionCheckbox:!0,selectWithCheckboxOnly:!1,useExternalSorting:!1,sortInfo:t.observable(void 0),multiSelect:!0,tabIndex:-1,enableColumnResize:!0,enableSorting:!0,maintainColumnRatios:void 0,beforeSelectionChange:function(){return!0},afterSelectionChange:function(){},columnsChanged:function(){},rowTemplate:void 0,headerRowTemplate:void 0,jqueryUITheme:!1,jqueryUIDraggable:!1,plugins:[],keepLastSelected:!0,groups:[],showGroupPanel:!1,enableRowReordering:!1,showColumnMenu:!0,showFilter:!0,disableTextSelection:!0,filterOptions:{filterText:t.observable(""),useExternalFilter:!1},enablePaging:!1,pagingOptions:{pageSizes:t.observableArray([250,500,1e3]),pageSize:t.observable(250),totalServerItems:t.observable(0),currentPage:t.observable(1)}},s=this;s.maxCanvasHt=t.observable(0),s.config=e.extend(l,n),s.config.columnDefs=t.utils.unwrapObservable(n.columnDefs),s.gridId="ng"+o.kg.utils.newId(),s.$root=null,s.$groupPanel=null,s.$topPanel=null,s.$headerContainer=null,s.$headerScroller=null,s.$headers=null,s.$viewport=null,s.$canvas=null,s.rootDim=s.config.gridDim,s.sortInfo=t.isObservable(s.config.sortInfo)?s.config.sortInfo:t.observable(s.config.sortInfo),s.sortedData=s.config.data,s.lateBindColumns=!1,s.filteredData=t.observableArray([]),s.lastSortedColumn=void 0,s.showFilter=s.config.showFilter,s.filterText=s.config.filterOptions.filterText,s.disableTextSelection=t.observable(s.config.disableTextSelection),s.calcMaxCanvasHeight=function(){return s.configGroups().length>0?s.rowFactory.parsedData.filter(function(e){return e[g]===!1}).length*s.config.rowHeight:s.filteredData().length*s.config.rowHeight},s.elementDims={scrollW:0,scrollH:0,rowIndexCellW:25,rowSelectedCellW:25,rootMaxW:0,rootMaxH:0},s.setRenderedRows=function(e){s.renderedRows(e),s.refreshDomSizes()},s.minRowsToRender=function(){var e=s.viewportDimHeight()||1;return Math.floor(e/s.config.rowHeight)},s.refreshDomSizes=function(){s.rootDim.outerWidth(s.elementDims.rootMaxW),s.rootDim.outerHeight(s.elementDims.rootMaxH),s.maxCanvasHt(s.calcMaxCanvasHeight())},s.buildColumnDefsFromData=function(){var e,t=s.sortedData();return s.config.columnDefs||(s.config.columnDefs=[]),t&&t[0]?(e=t[0],void o.kg.utils.forIn(e,function(e,t){t!=i&&s.config.columnDefs.push({field:t})})):void(s.lateBoundColumns=!0)},s.buildColumns=function(){var t=s.config.columnDefs,n=[];t||(s.buildColumnDefsFromData(),t=s.config.columnDefs),s.config.displaySelectionCheckbox&&s.config.canSelectRows&&t.splice(0,0,{field:"✔",width:s.elementDims.rowSelectedCellW,sortable:!1,resizable:!1,headerCellTemplate:'<input class="kgSelectionHeader" type="checkbox" data-bind="visible: $grid.multiSelect, checked: $grid.allSelected"/>',cellTemplate:'<div class="kgSelectionCell"><input class="kgSelectionCheckbox" type="checkbox" data-bind="checked: $parent.selected" /></div>'}),t.length>0&&(e.each(t,function(e,t){var i,r=new o.kg.Column({colDef:t,index:e,headerRowHeight:s.config.headerRowHeight,sortCallback:s.sortData,resizeOnDataCallback:s.resizeOnData,enableResize:s.config.enableColumnResize,enableSort:s.config.enableSorting},s);n.push(r),i=s.config.groups.indexOf(t.field),-1!=i&&s.configGroups.splice(i,0,r)}),s.columns(n))},s.configureColumnWidths=function(){var t,n,i=s.config.columnDefs,r=i.length,a=[],l=[],c=0,d=0,g=s.columns();e.each(i,function(t,n){var i,r=!1,u=void 0;if(o.kg.utils.isNullOrUndefined(n.width)?n.width="*":(r=isNaN(n.width)?o.kg.utils.endsWith(n.width,"%"):!1,u=r?n.width:parseInt(n.width,10)),isNaN(u)){if(u=n.width,"auto"==u)return g[t].width=g[t].minWidth,i=g[t],void e(document).ready(function(){s.resizeOnData(i,!0)});if(-1!=u.indexOf("*"))return c+=u.length,n.index=t,void a.push(n);if(r)return n.index=t,void l.push(n);throw'unable to parse column width, use percentage ("10%","20%", etc...) or "*" to use remaining width of grid'}d+=g[t].width=parseInt(n.width,10)}),a.length>0&&(s.config.maintainColumnRatios===!1?e.noop():s.config.maintainColumnRatios=!0,t=s.rootDim.outerWidth()-d,n=Math.floor(t/c),e.each(a,function(e,t){var i,a=t.width.length;g[t.index].width=n*a,t.index+1==r&&(i=2,s.maxCanvasHt()>s.viewportDimHeight()&&(i+=o.kg.domUtilityService.ScrollW),g[t.index].width-=i),d+=g[t.index].width})),l.length>0&&e.each(l,function(e,t){var o=t.width;g[t.index].width=Math.floor(s.rootDim.outerWidth()*(parseInt(o.slice(0,-1),10)/100))}),s.columns(g),o.kg.domUtilityService.BuildStyles(s)},s.init=function(){s.selectionService=new o.kg.SelectionService(s),s.rowFactory=new o.kg.RowFactory(s),s.selectionService.Initialize(s.rowFactory),s.searchProvider=new o.kg.SearchProvider(s),s.styleProvider=new o.kg.StyleProvider(s),s.buildColumns(),o.kg.sortService.columns=s.columns,s.configGroups.subscribe(function(t){if(t){var o=[];e.each(t,function(e,t){t&&o.push(t.field||t)}),s.config.groups=o,s.rowFactory.filteredDataChanged()}}),s.filteredData.subscribe(function(){s.$$selectionPhase||(s.maxCanvasHt(s.calcMaxCanvasHeight()),s.isSorting||s.configureColumnWidths())}),s.maxCanvasHt(s.calcMaxCanvasHeight()),s.searchProvider.evalFilter(),s.refreshDomSizes()},s.prevScrollTop=0,s.prevScrollIndex=0,s.adjustScrollTop=function(e,t){if(s.prevScrollTop!==e||t){var n=Math.floor(e/s.config.rowHeight);s.prevScrollTop<e&&n<s.prevScrollIndex+a||s.prevScrollTop>e&&n>s.prevScrollIndex-a||(s.prevScrollTop=e,s.rowFactory.UpdateViewableRange(new o.kg.Range(Math.max(0,n-r),n+s.minRowsToRender()+r)),s.prevScrollIndex=n)}},s.adjustScrollLeft=function(e){s.$headerContainer&&s.$headerContainer.scrollLeft(e)},s.resizeOnData=function(t){var n=t.minWidth,i=o.kg.utils.getElementsByClassName("col"+t.index);e.each(i,function(t,i){var r,a,l;0===t?(a=e(i).find(".kgHeaderText"),r=o.kg.utils.visualLength(a)+10):(l=e(i).find(".kgCellText"),r=o.kg.utils.visualLength(l)+10),r>n&&(n=r)}),t.width=n=Math.min(t.maxWidth,n+7),o.kg.domUtilityService.BuildStyles(s)},s.sortData=function(e,t){s.isSorting=!0,s.sortInfo({column:e,direction:t}),s.clearSortingData(e),s.config.useExternalSorting?s.config.sortInfo(s.sortInfo.peek()):o.kg.sortService.Sort(s.sortInfo.peek(),s.sortedData),s.lastSortedColumn=e,s.isSorting=!1},s.clearSortingData=function(t){t?s.lastSortedColumn&&t!=s.lastSortedColumn&&s.lastSortedColumn.sortDirection(""):e.each(s.columns(),function(e,t){t.sortDirection("")})},s.fixColumnIndexes=function(){s.$$indexPhase=!0;var t=s.columns.peek();e.each(t,function(e,t){t.index=e}),s.$$indexPhase=!1},s.elementsNeedMeasuring=!0,s.columns=t.observableArray([]),s.columns.subscribe(function(e){s.config.columnsChanged(e)}),s.renderedRows=t.observableArray([]),s.headerRow=null,s.rowHeight=s.config.rowHeight,s.jqueryUITheme=t.observable(s.config.jqueryUITheme),s.footer=null,s.selectedItems=s.config.selectedItems,s.multiSelect=s.config.multiSelect,s.footerVisible=o.kg.utils.isNullOrUndefined(s.config.displayFooter)?s.config.footerVisible:s.config.displayFooter,s.config.footerRowHeight=s.footerVisible?s.config.footerRowHeight:0,s.showColumnMenu=s.config.showColumnMenu,s.showMenu=t.observable(!1),s.configGroups=t.observableArray([]),s.enablePaging=s.config.enablePaging,s.pagingOptions=s.config.pagingOptions,s.rowTemplate=s.config.rowTemplate||o.kg.defaultRowTemplate(),s.headerRowTemplate=s.config.headerRowTemplate||o.kg.defaultHeaderRowTemplate(),s.config.rowTemplate&&!p.test(s.config.rowTemplate)&&(s.rowTemplate=o.kg.utils.getTemplatePromise(s.config.rowTemplate)),s.config.headerRowTemplate&&!p.test(s.config.headerRowTemplate)&&(s.headerRowTemplate=o.kg.utils.getTemplatePromise(s.config.headerRowTemplate)),s.visibleColumns=t.computed(function(){var e=s.columns();return e.filter(function(e){return e.visible()})}),s.nonAggColumns=t.computed(function(){return s.columns().filter(function(e){return!e.isAggCol})}),s.toggleShowMenu=function(){s.showMenu(!s.showMenu())},s.allSelected=s.config.selectAllState,s.allSelected.subscribe(function(e){s.config.beforeSelectionChange(s.sortedData.peek(),this)&&(s.selectionService.toggleSelectAll(e),s.config.afterSelectionChange(s.selectedItems.peek(),this))}),s.totalFilteredItemsLength=t.computed(function(){return s.filteredData().length}),s.showGroupPanel=t.computed(function(){return s.config.showGroupPanel}),s.topPanelHeight=t.observable(s.config.showGroupPanel===!0?2*s.config.headerRowHeight:s.config.headerRowHeight),s.viewportDimHeight=t.computed(function(){return Math.max(0,s.rootDim.outerHeight()-s.topPanelHeight()-s.config.footerRowHeight-2)}),s.groupBy=function(e){if(!(s.sortedData().length<1)){var t=s.configGroups().indexOf(e);
-1==t?(e.isGroupedBy(!0),s.configGroups.push(e),e.groupIndex(s.configGroups().length)):s.removeGroup(t),o.kg.domUtilityService.BuildStyles(s)}},s.removeGroup=function(e){var t=s.columns().filter(function(t){return t.groupIndex()==e+1})[0];t.isGroupedBy(!1),t.groupIndex(0),s.columns.splice(e,1),s.configGroups.splice(e,1),s.fixGroupIndexes(),0===s.configGroups().length&&s.fixColumnIndexes(),o.kg.domUtilityService.BuildStyles(s)},s.fixGroupIndexes=function(){e.each(s.configGroups(),function(e,t){t.groupIndex(e+1)})},s.totalRowWidth=function(){var t=0,o=s.visibleColumns();return e.each(o,function(e,o){t+=o.width}),t},s.headerScrollerDim=function(){var e=s.viewportDimHeight(),t=s.maxCanvasHt(),n=t>e,i=new o.kg.Dimension;return i.autoFitHeight=!0,i.outerWidth=s.totalRowWidth(),n?i.outerWidth+=s.elementDims.scrollW:t-e<=s.elementDims.scrollH&&(i.outerWidth+=s.elementDims.scrollW),i},s.jqueryUITheme=s.config.jqueryUITheme,s.maxRows=t.observable(Math.max(s.config.pagingOptions.totalServerItems()||s.sortedData().length,1)),s.maxRowsDisplay=t.computed(function(){return s.maxRows()}),s.multiSelect=t.observable(s.config.canSelectRows&&s.config.multiSelect),s.selectedItemCount=t.computed(function(){return s.selectedItems().length}),s.maxPages=t.computed(function(){return s.maxRows(Math.max(s.config.pagingOptions.totalServerItems()||s.sortedData().length,1)),Math.ceil(s.maxRows()/s.pagingOptions.pageSize())}),s.pageForward=function(){var e=s.config.pagingOptions.currentPage();s.config.pagingOptions.currentPage(Math.min(e+1,s.maxPages()))},s.pageBackward=function(){var e=s.config.pagingOptions.currentPage();s.config.pagingOptions.currentPage(Math.max(e-1,1))},s.pageToFirst=function(){s.config.pagingOptions.currentPage(1)},s.pageToLast=function(){var e=s.maxPages();s.config.pagingOptions.currentPage(e)},s.cantPageForward=t.computed(function(){var e=s.config.pagingOptions.currentPage(),t=s.maxPages();return!(t>e)}),s.cantPageBackward=t.computed(function(){var e=s.config.pagingOptions.currentPage();return!(e>1)}),s.init()},kg.Range=function(e,t){this.topRow=e,this.bottomRow=t},o.kg.Row=function(e,n,r){var a=this;a.canSelectRows=n.canSelectRows,a.rowClasses=n.rowClasses,a.selectedItems=n.selectedItems,a.entity=e,a.selectionService=r,a.selected=t.observable(!1),a.continueSelection=function(e){a.selectionService.ChangeSelection(a,e)},a.toggleSelected=function(e,t){if(!a.canSelectRows)return!0;var o=t.target||t;return"checkbox"==o.type&&a.selected(!a.selected()),n.selectWithCheckboxOnly&&"checkbox"!=o.type?!0:a.beforeSelectionChange(a,t)?(a.continueSelection(t),a.afterSelectionChange(a,t)):!1},void 0===a.entity[i]?a.entity[i]=!1:a.selectionService.setSelection(a,a.entity[i]),a.rowIndex=t.observable(0),a.offsetTop=t.observable("0px"),a.rowDisplayIndex=0,a.isEven=t.computed(function(){return a.rowIndex()%2==0}),a.isOdd=t.computed(function(){return a.rowIndex()%2!=0}),a.beforeSelectionChange=n.beforeSelectionChangeCallback,a.afterSelectionChange=n.afterSelectionChangeCallback,a.propertyCache={},a.getProperty=function(e){return a.propertyCache[e]||(a.propertyCache[e]=o.kg.utils.evalProperty(a.entity,e))}},o.kg.SearchProvider=function(o){var n,i=this,r=[];i.extFilter=o.config.filterOptions.useExternalFilter,i.showFilter=o.config.showFilter,i.filterText=o.config.filterOptions.filterText,i.throttle=o.config.filterOptions.filterThrottle,i.fieldMap={},i.evalFilter=function(){0===r.length?o.filteredData(o.sortedData.peek().filter(function(e){return!e._destroy})):o.filteredData(o.sortedData.peek().filter(function(e){var o,n,a,l,s,c;if(e._destroy)return!1;for(o=0,n=r.length;n>o;o++){if(a=r[o],!a.column){for(l in e)if(e.hasOwnProperty(l)&&(s=t.utils.unwrapObservable(e[l]),s&&a.regex.test(s.toString())))return!0;return!1}if(c=t.utils.unwrapObservable(e[a.column])||t.utils.unwrapObservable(e[i.fieldMap[a.columnDisplay]]),!c||!a.regex.test(c.toString()))return!1}return!0})),o.rowFactory.filteredDataChanged()};var a=function(e,t){try{return new RegExp(e,t)}catch(o){return new RegExp(e.replace(/(\^|\$|\(|\)|\<|\>|\[|\]|\{|\}|\\|\||\.|\*|\+|\?)/g,"\\$1"))}},l=function(t){var o,n;r=[],(o=e.trim(t))&&(n=o.split(";"),e.each(n,function(t,o){var n,i,l,s=o.split(":");s.length>1?(n=e.trim(s[0]),i=e.trim(s[1]),n&&i&&r.push({column:n,columnDisplay:n.replace(/\s+/g,"").toLowerCase(),regex:a(i,"i")})):(l=e.trim(s[0]),l&&r.push({column:"",regex:a(l,"i")}))}))},s=t.computed(function(){var e=i.filterText();i.extFilter||e==n||(n=e,l(e),i.evalFilter())});"number"==typeof i.throttle&&s.extend({throttle:i.throttle}),i.extFilter||o.columns.subscribe(function(t){e.each(t,function(e,t){i.fieldMap[t.displayName().toLowerCase().replace(/\s+/g,"")]=t.field})})},o.kg.SelectionService=function(t){var o=this;o.multi=t.config.multiSelect,o.selectedItems=t.config.selectedItems,o.selectedIndex=t.config.selectedIndex,o.lastClickedRow=void 0,o.ignoreSelectedItemChanges=!1,o.rowFactory={},o.Initialize=function(e){o.rowFactory=e},o.ChangeSelection=function(n,r){var a,l,s;if(t.$$selectionPhase=!0,r&&r.shiftKey&&o.multi){if(o.lastClickedRow){if(a=t.filteredData.indexOf(n.entity),l=t.filteredData.indexOf(o.lastClickedRow.entity),a==l)return!1;for(l++,l>a&&(a^=l,l=a^l,a^=l),s=[];a>=l;l++)s.push(o.rowFactory.rowCache[l]);return s[s.length-1].beforeSelectionChange(s,r)&&(e.each(s,function(e,t){t.selected(!0),t.entity[i]=!0,-1===o.selectedItems.indexOf(t.entity)&&o.selectedItems.push(t.entity)}),s[s.length-1].afterSelectionChange(s,r)),o.lastClickedRow=s[s.length-1],!0}}else o.multi?o.setSelection(n,!n.selected()):(o.lastClickedRow&&o.lastClickedRow!=n&&o.setSelection(o.lastClickedRow,!1),o.setSelection(n,t.config.keepLastSelected?!0:!n.selected()));return o.lastClickedRow=n,t.$$selectionPhase=!1,!0},o.setSelection=function(e,t){if(e.selected(t),e.entity[i]=t,t)-1===o.selectedItems.indexOf(e.entity)&&o.selectedItems.push(e.entity);else{var n=o.selectedItems.indexOf(e.entity);o.selectedItems.splice(n,1)}},o.toggleSelectAll=function(n){var r=o.selectedItems().length;r>0&&o.selectedItems.splice(0,r),e.each(t.filteredData(),function(e,t){t[i]=n,n&&o.selectedItems.push(t)}),e.each(o.rowFactory.rowCache,function(e,t){t&&t.selected&&t.selected(n)})}},o.kg.StyleProvider=function(e){e.canvasStyle=t.computed(function(){return{height:e.maxCanvasHt().toString()+"px"}}),e.headerScrollerStyle=t.computed(function(){return{height:e.config.headerRowHeight+"px"}}),e.topPanelStyle=t.computed(function(){return{width:e.rootDim.outerWidth()+"px",height:e.topPanelHeight()+"px"}}),e.headerStyle=t.computed(function(){return{width:Math.max(0,e.rootDim.outerWidth()-o.kg.domUtilityService.ScrollW)+"px",height:e.config.headerRowHeight+"px"}}),e.viewportStyle=t.computed(function(){return{width:e.rootDim.outerWidth()+"px",height:e.viewportDimHeight()+"px"}}),e.footerStyle=t.computed(function(){return{width:e.rootDim.outerWidth()+"px",height:e.config.footerRowHeight+"px"}})},o.kg.sortService={colSortFnCache:{},dateRE:/^(\d\d?)[\/\.-](\d\d?)[\/\.-]((\d\d)?\d\d)$/,guessSortFn:function(e){var t,n,i,r,a;if(void 0===e||null===e||""===e)return null;switch(n=typeof e){case"number":t=o.kg.sortService.sortNumber;break;case"boolean":t=o.kg.sortService.sortBool;break;default:t=void 0}return t?t:"[object Date]"===Object.prototype.toString.call(e)?o.kg.sortService.sortDate:"string"!==n?o.kg.sortService.basicSort:e.match(/^-?[�$�]?[\d,.]+%?$/)?o.kg.sortService.sortNumberStr:(i=e.match(o.kg.sortService.dateRE))?(r=parseInt(i[1],10),a=parseInt(i[2],10),r>12?o.kg.sortService.sortDDMMStr:a>12?o.kg.sortService.sortMMDDStr:o.kg.sortService.sortMMDDStr):o.kg.sortService.sortAlpha},basicSort:function(e,t){return e==t?0:t>e?-1:1},sortNumber:function(e,t){return e-t},sortNumberStr:function(e,t){var o,n,i=!1,r=!1;return o=parseFloat(e.replace(/[^0-9.-]/g,"")),isNaN(o)&&(i=!0),n=parseFloat(t.replace(/[^0-9.-]/g,"")),isNaN(n)&&(r=!0),i&&r?0:i?1:r?-1:o-n},sortAlpha:function(e,t){var o=e.toLowerCase(),n=t.toLowerCase();return o==n?0:n>o?-1:1},sortBool:function(e,t){return e&&t?0:e||t?e?1:-1:0},sortDate:function(e,t){var o=e.getTime(),n=t.getTime();return o==n?0:n>o?-1:1},sortDDMMStr:function(e,t){var n,i,r,a,l,s;return r=e.match(o.kg.sortService.dateRE),s=r[3],a=r[2],l=r[1],1==a.length&&(a="0"+a),1==l.length&&(l="0"+l),n=s+a+l,r=t.match(o.kg.sortService.dateRE),s=r[3],a=r[2],l=r[1],1==a.length&&(a="0"+a),1==l.length&&(l="0"+l),i=s+a+l,n==i?0:i>n?-1:1},sortMMDDStr:function(e,t){var n,i,r,a,l,s;return r=e.match(o.kg.sortService.dateRE),s=r[3],l=r[2],a=r[1],1==a.length&&(a="0"+a),1==l.length&&(l="0"+l),n=s+a+l,r=t.match(dateRE),s=r[3],l=r[2],a=r[1],1==a.length&&(a="0"+a),1==l.length&&(l="0"+l),i=s+a+l,n==i?0:i>n?-1:1},sortData:function(e,t){var n,i,r,a,s=e();if(s&&t){if(n=t.column,i=t.direction,o.kg.sortService.colSortFnCache[n.field])r=o.kg.sortService.colSortFnCache[n.field];else if(void 0!=n.sortingAlgorithm)r=n.sortingAlgorithm,o.kg.sortService.colSortFnCache[n.field]=n.sortingAlgorithm;else{if(a=s[0],!a)return;r=kg.sortService.guessSortFn(a[n.field]),r?o.kg.sortService.colSortFnCache[n.field]=r:r=o.kg.sortService.sortAlpha}return s.sort(function(e,t){var a=o.kg.utils.evalProperty(e,n.field),s=o.kg.utils.evalProperty(t,n.field);return s||a?a?s?i===l?r(a,s):0-r(a,s):-1:1:0}),void e(s)}},Sort:function(e,t){o.kg.sortService.isSorting||(o.kg.sortService.isSorting=!0,o.kg.sortService.sortData(t,e),o.kg.sortService.isSorting=!1)}},n=function(){var t=e("<div></div>");t.appendTo("body"),t.height(100).width(100).css("position","absolute").css("overflow","scroll"),t.append('<div style="height: 400px; width: 400px;"></div>'),o.kg.domUtilityService.ScrollH=t.height()-t[0].clientHeight,o.kg.domUtilityService.ScrollW=t.width()-t[0].clientWidth,t.empty(),t.attr("style",""),t.append('<span style="font-family: Verdana, Helvetica, Sans-Serif; font-size: 14px;"><strong>M</strong></span>'),o.kg.domUtilityService.LetterW=t.children().first().width(),t.remove()},o.kg.domUtilityService={AssignGridContainers:function(t,n){n.$root=e(t),n.$topPanel=n.$root.find(".kgTopPanel"),n.$groupPanel=n.$root.find(".kgGroupPanel"),n.$headerContainer=n.$topPanel.find(".kgHeaderContainer"),n.$headerScroller=n.$topPanel.find(".kgHeaderScroller"),n.$headers=n.$headerScroller.children(),n.$viewport=n.$root.find(".kgViewport"),n.$canvas=n.$viewport.find(".kgCanvas"),n.$footerPanel=n.$root.find(".ngFooterPanel"),o.kg.domUtilityService.UpdateGridLayout(n)},UpdateGridLayout:function(e){var t=e.$viewport.scrollTop();e.elementDims.rootMaxW=e.$root.width(),e.elementDims.rootMaxH=e.$root.height(),e.refreshDomSizes(),e.adjustScrollTop(t,!0)},BuildStyles:function(t){var n,i,r=t.config.rowHeight,a=t.$styleSheet,l=t.gridId,s=t.visibleColumns(),c=0;a||(a=e("#"+l),a[0]||(a=e("<style id='"+l+"' type='text/css' rel='stylesheet' />"),a.appendTo("body"))),a.empty(),i=t.totalRowWidth(),n="."+l+" .kgCanvas { width: "+i+"px; }."+l+" .kgRow { width: "+i+"px; }."+l+" .kgCell { height: "+r+"px; }."+l+" .kgCanvas { width: "+i+"px; }."+l+" .kgHeaderCell { top: 0; bottom: 0; }."+l+" .kgHeaderScroller { width: "+(i+o.kg.domUtilityService.scrollH+2)+"px}",e.each(s,function(e,t){n+="."+l+" .col"+e+" { width: "+t.width+"px; left: "+c+"px; right: "+(i-c-t.width)+"px; height: "+r+"px }."+l+" .colt"+e+" { width: "+t.width+"px; }",c+=t.width}),o.kg.utils.isIe?a[0].styleSheet.cssText=n:a.append(document.createTextNode(n)),t.$styleSheet=a},ScrollH:17,ScrollW:17,LetterW:10},n()}(window)});